================================================================================
Testing Single Image Upload: S__91693062_0.jpg
================================================================================
{"agent": "GeminiStructuredExtractor", "timestamp": "2025-11-24T04:00:18.937270Z", "model": "gemini-2.5-flash", "temperature": 0.1, "event": "GeminiStructuredExtractor initialized", "level": "info"}
{"agent": "HealthReportParser", "timestamp": "2025-11-24T04:00:18.937270Z", "file": "S__91693062_0.jpg", "action": "parse_start", "event": "Parsing started", "level": "info"}
{"agent": "HealthReportParser", "timestamp": "2025-11-24T04:00:18.937270Z", "file_type": "jpg", "event": "File type detected", "level": "info"}
{"agent": "HealthReportParser", "timestamp": "2025-11-24T04:00:18.938269Z", "event": "Preprocessing mobile photo for OCR optimization", "level": "info"}
{"agent": "HealthReportParser", "timestamp": "2025-11-24T04:00:28.078794Z", "output": "S__91693062_0_preprocessed.jpg", "event": "Image preprocessing completed", "level": "info"}
{"agent": "HealthReportParser", "timestamp": "2025-11-24T04:00:28.078794Z", "file": "S__91693062_0_preprocessed.jpg", "action": "load_image", "event": "Loading image", "level": "info"}
{"agent": "HealthReportParser", "timestamp": "2025-11-24T04:00:28.078794Z", "file": "S__91693062_0_preprocessed.jpg", "size": [4687, 6250], "format": "JPEG", "event": "Image loaded successfully", "level": "info"}
{"agent": "HealthReportParser", "timestamp": "2025-11-24T04:00:28.078794Z", "page_count": 1, "action": "extract_from_ocr", "event": "Extracting data from OCR", "level": "info"}
INFO: Could not find files for the given pattern(s).
C:\Users\Kun\Desktop\health-action-squad\venv\Lib\site-packages\paddle\utils\cpp_extension\extension_utils.py:718: UserWarning: No ccache found. Please be aware that recompiling all source files may be required. You can download and install ccache from: https://github.com/ccache/ccache/blob/master/doc/INSTALL.md
  warnings.warn(warning_message)
[32mCreating model: ('PP-LCNet_x1_0_doc_ori', None)[0m
[32mModel files already exist. Using cached files. To redownload, please delete the directory manually: `C:\Users\Kun\.paddlex\official_models\PP-LCNet_x1_0_doc_ori`.[0m
WARNING: Logging before InitGoogleLogging() is written to STDERR
I1124 12:00:30.573374 21780 onednn_context.cc:81] oneDNN v3.6.2
[32mCreating model: ('UVDoc', None)[0m
[32mModel files already exist. Using cached files. To redownload, please delete the directory manually: `C:\Users\Kun\.paddlex\official_models\UVDoc`.[0m
[32mCreating model: ('PP-LCNet_x1_0_textline_ori', None)[0m
[32mModel files already exist. Using cached files. To redownload, please delete the directory manually: `C:\Users\Kun\.paddlex\official_models\PP-LCNet_x1_0_textline_ori`.[0m
[32mCreating model: ('PP-OCRv5_server_det', None)[0m
[32mModel files already exist. Using cached files. To redownload, please delete the directory manually: `C:\Users\Kun\.paddlex\official_models\PP-OCRv5_server_det`.[0m
[32mCreating model: ('PP-OCRv5_server_rec', None)[0m
[32mModel files already exist. Using cached files. To redownload, please delete the directory manually: `C:\Users\Kun\.paddlex\official_models\PP-OCRv5_server_rec`.[0m
{"agent": "PaddleOCRParser", "timestamp": "2025-11-24T04:00:36.531400Z", "language": "chinese_cht", "device": "cpu", "event": "PaddleOCR initialized", "level": "info"}
{"agent": "PaddleOCRParser", "timestamp": "2025-11-24T04:00:36.534421Z", "error": "PaddleOCR.predict() got an unexpected keyword argument 'cls'", "event": "OCR execution failed", "level": "error"}
{"agent": "PaddleOCRParser", "timestamp": "2025-11-24T04:00:36.535417Z", "error": "OCR failed to process: C:\\Users\\Kun\\AppData\\Local\\Temp\\tmpq4fqck12\\page_0.jpg", "event": "Error parsing health report", "level": "error"}
{"agent": "HealthReportParser", "timestamp": "2025-11-24T04:00:36.537411Z", "error": "OCR failed to process: C:\\Users\\Kun\\AppData\\Local\\Temp\\tmpq4fqck12\\page_0.jpg", "page_count": 1, "event": "OCR extraction failed", "level": "error"}
{"agent": "HealthReportParser", "timestamp": "2025-11-24T04:00:36.537411Z", "completeness": 0.0, "event": "OCR extraction completed", "level": "info"}
{"agent": "HealthReportParser", "timestamp": "2025-11-24T04:00:36.537411Z", "ocr_completeness": 0.0, "threshold": 0.7, "event": "Activating LLM fallback", "level": "info"}
{"agent": "GeminiStructuredExtractor", "timestamp": "2025-11-24T04:00:36.537411Z", "input_type": "file", "action": "extract_start", "event": "LLM extraction started", "level": "info"}
{"agent": "GeminiStructuredExtractor", "timestamp": "2025-11-24T04:00:36.537411Z", "file": "S__91693062_0.jpg", "action": "extract_from_image", "event": "Extracting from image using Gemini Vision", "level": "info"}
{"agent": "GeminiStructuredExtractor", "timestamp": "2025-11-24T04:00:41.237630Z", "file": "S__91693062_0.jpg", "fields_extracted": 7, "event": "Image extraction successful", "level": "info"}
{"agent": "GeminiStructuredExtractor", "timestamp": "2025-11-24T04:00:41.237630Z", "fields_extracted": 7, "event": "LLM extraction completed successfully", "level": "info"}
{"agent": "HealthReportParser", "timestamp": "2025-11-24T04:00:41.237630Z", "llm_completeness": 0.42857142857142855, "source": "hybrid", "event": "LLM fallback completed", "level": "info"}
{"agent": "HealthReportParser", "timestamp": "2025-11-24T04:00:41.237630Z", "file": "S__91693062_0.jpg", "source": "hybrid", "completeness": 0.42857142857142855, "event": "Parsing completed successfully", "level": "info"}

âœ… Parsing Result:
  - Completeness: 42.86%
  - Source: hybrid
  - Fields extracted: 7

ðŸ“Š Extracted Data:
  - blood_pressure: 112/68
  - systolic: 112
  - diastolic: 68
  - bmi: 18.7
  - weight: 59.1
  - height: 177.3
  - heart_rate: 85

================================================================================
Testing Batch Image Upload: Both images
================================================================================
{"agent": "GeminiStructuredExtractor", "timestamp": "2025-11-24T04:00:41.239629Z", "model": "gemini-2.5-flash", "temperature": 0.1, "event": "GeminiStructuredExtractor initialized", "level": "info"}
{"agent": "HealthReportParser", "timestamp": "2025-11-24T04:00:41.239629Z", "file_count": 2, "merge": true, "event": "Batch parsing started", "level": "info"}
{"agent": "HealthReportParser", "timestamp": "2025-11-24T04:00:41.239629Z", "file": "S__91693062_0.jpg", "action": "parse_start", "event": "Parsing started", "level": "info"}
{"agent": "HealthReportParser", "timestamp": "2025-11-24T04:00:41.239629Z", "file_type": "jpg", "event": "File type detected", "level": "info"}
{"agent": "HealthReportParser", "timestamp": "2025-11-24T04:00:41.240641Z", "event": "Preprocessing mobile photo for OCR optimization", "level": "info"}
{"agent": "HealthReportParser", "timestamp": "2025-11-24T04:00:41.240641Z", "file": "S__91693063_0.jpg", "action": "parse_start", "event": "Parsing started", "level": "info"}
{"agent": "HealthReportParser", "timestamp": "2025-11-24T04:00:41.240641Z", "file_type": "jpg", "event": "File type detected", "level": "info"}
{"agent": "HealthReportParser", "timestamp": "2025-11-24T04:00:41.240641Z", "event": "Preprocessing mobile photo for OCR optimization", "level": "info"}
{"agent": "HealthReportParser", "timestamp": "2025-11-24T04:00:51.353842Z", "output": "S__91693063_0_preprocessed.jpg", "event": "Image preprocessing completed", "level": "info"}
{"agent": "HealthReportParser", "timestamp": "2025-11-24T04:00:51.353842Z", "file": "S__91693063_0_preprocessed.jpg", "action": "load_image", "event": "Loading image", "level": "info"}
{"agent": "HealthReportParser", "timestamp": "2025-11-24T04:00:51.354841Z", "file": "S__91693063_0_preprocessed.jpg", "size": [4687, 6250], "format": "JPEG", "event": "Image loaded successfully", "level": "info"}
{"agent": "HealthReportParser", "timestamp": "2025-11-24T04:00:51.354841Z", "page_count": 1, "action": "extract_from_ocr", "event": "Extracting data from OCR", "level": "info"}
[32mCreating model: ('PP-LCNet_x1_0_doc_ori', None)[0m
[32mModel files already exist. Using cached files. To redownload, please delete the directory manually: `C:\Users\Kun\.paddlex\official_models\PP-LCNet_x1_0_doc_ori`.[0m
I1124 12:00:51.721520 22524 onednn_context.cc:81] oneDNN v3.6.2
[32mCreating model: ('UVDoc', None)[0m
[32mModel files already exist. Using cached files. To redownload, please delete the directory manually: `C:\Users\Kun\.paddlex\official_models\UVDoc`.[0m
[32mCreating model: ('PP-LCNet_x1_0_textline_ori', None)[0m
[32mModel files already exist. Using cached files. To redownload, please delete the directory manually: `C:\Users\Kun\.paddlex\official_models\PP-LCNet_x1_0_textline_ori`.[0m
[32mCreating model: ('PP-OCRv5_server_det', None)[0m
[32mModel files already exist. Using cached files. To redownload, please delete the directory manually: `C:\Users\Kun\.paddlex\official_models\PP-OCRv5_server_det`.[0m
[32mCreating model: ('PP-OCRv5_server_rec', None)[0m
[32mModel files already exist. Using cached files. To redownload, please delete the directory manually: `C:\Users\Kun\.paddlex\official_models\PP-OCRv5_server_rec`.[0m
{"agent": "PaddleOCRParser", "timestamp": "2025-11-24T04:00:58.264416Z", "language": "chinese_cht", "device": "cpu", "event": "PaddleOCR initialized", "level": "info"}
{"agent": "PaddleOCRParser", "timestamp": "2025-11-24T04:00:58.266424Z", "error": "PaddleOCR.predict() got an unexpected keyword argument 'cls'", "event": "OCR execution failed", "level": "error"}
{"agent": "PaddleOCRParser", "timestamp": "2025-11-24T04:00:58.267421Z", "error": "OCR failed to process: C:\\Users\\Kun\\AppData\\Local\\Temp\\tmp1_si0fh1\\page_0.jpg", "event": "Error parsing health report", "level": "error"}
{"agent": "HealthReportParser", "timestamp": "2025-11-24T04:00:58.269417Z", "error": "OCR failed to process: C:\\Users\\Kun\\AppData\\Local\\Temp\\tmp1_si0fh1\\page_0.jpg", "page_count": 1, "event": "OCR extraction failed", "level": "error"}
{"agent": "HealthReportParser", "timestamp": "2025-11-24T04:00:58.270424Z", "completeness": 0.0, "event": "OCR extraction completed", "level": "info"}
{"agent": "HealthReportParser", "timestamp": "2025-11-24T04:00:58.270424Z", "ocr_completeness": 0.0, "threshold": 0.7, "event": "Activating LLM fallback", "level": "info"}
{"agent": "GeminiStructuredExtractor", "timestamp": "2025-11-24T04:00:58.270424Z", "input_type": "file", "action": "extract_start", "event": "LLM extraction started", "level": "info"}
{"agent": "GeminiStructuredExtractor", "timestamp": "2025-11-24T04:00:58.270424Z", "file": "S__91693063_0.jpg", "action": "extract_from_image", "event": "Extracting from image using Gemini Vision", "level": "info"}
{"agent": "GeminiStructuredExtractor", "timestamp": "2025-11-24T04:01:04.014463Z", "file": "S__91693063_0.jpg", "fields_extracted": 7, "event": "Image extraction successful", "level": "info"}
{"agent": "GeminiStructuredExtractor", "timestamp": "2025-11-24T04:01:04.014463Z", "fields_extracted": 7, "event": "LLM extraction completed successfully", "level": "info"}
{"agent": "HealthReportParser", "timestamp": "2025-11-24T04:01:04.014463Z", "llm_completeness": 0.14285714285714285, "source": "hybrid", "event": "LLM fallback completed", "level": "info"}
{"agent": "HealthReportParser", "timestamp": "2025-11-24T04:01:04.014463Z", "file": "S__91693063_0.jpg", "source": "hybrid", "completeness": 0.14285714285714285, "event": "Parsing completed successfully", "level": "info"}
{"agent": "HealthReportParser", "timestamp": "2025-11-24T04:01:05.570777Z", "output": "S__91693062_0_preprocessed.jpg", "event": "Image preprocessing completed", "level": "info"}
{"agent": "HealthReportParser", "timestamp": "2025-11-24T04:01:05.570777Z", "file": "S__91693062_0_preprocessed.jpg", "action": "load_image", "event": "Loading image", "level": "info"}
{"agent": "HealthReportParser", "timestamp": "2025-11-24T04:01:05.571319Z", "file": "S__91693062_0_preprocessed.jpg", "size": [4687, 6250], "format": "JPEG", "event": "Image loaded successfully", "level": "info"}
{"agent": "HealthReportParser", "timestamp": "2025-11-24T04:01:05.571319Z", "page_count": 1, "action": "extract_from_ocr", "event": "Extracting data from OCR", "level": "info"}
[32mCreating model: ('PP-LCNet_x1_0_doc_ori', None)[0m
[32mModel files already exist. Using cached files. To redownload, please delete the directory manually: `C:\Users\Kun\.paddlex\official_models\PP-LCNet_x1_0_doc_ori`.[0m
[32mCreating model: ('UVDoc', None)[0m
[32mModel files already exist. Using cached files. To redownload, please delete the directory manually: `C:\Users\Kun\.paddlex\official_models\UVDoc`.[0m
[32mCreating model: ('PP-LCNet_x1_0_textline_ori', None)[0m
[32mModel files already exist. Using cached files. To redownload, please delete the directory manually: `C:\Users\Kun\.paddlex\official_models\PP-LCNet_x1_0_textline_ori`.[0m
[32mCreating model: ('PP-OCRv5_server_det', None)[0m
[32mModel files already exist. Using cached files. To redownload, please delete the directory manually: `C:\Users\Kun\.paddlex\official_models\PP-OCRv5_server_det`.[0m
[32mCreating model: ('PP-OCRv5_server_rec', None)[0m
[32mModel files already exist. Using cached files. To redownload, please delete the directory manually: `C:\Users\Kun\.paddlex\official_models\PP-OCRv5_server_rec`.[0m
{"agent": "PaddleOCRParser", "timestamp": "2025-11-24T04:01:11.905929Z", "language": "chinese_cht", "device": "cpu", "event": "PaddleOCR initialized", "level": "info"}
{"agent": "PaddleOCRParser", "timestamp": "2025-11-24T04:01:11.906933Z", "error": "PaddleOCR.predict() got an unexpected keyword argument 'cls'", "event": "OCR execution failed", "level": "error"}
{"agent": "PaddleOCRParser", "timestamp": "2025-11-24T04:01:11.906933Z", "error": "OCR failed to process: C:\\Users\\Kun\\AppData\\Local\\Temp\\tmp1qns7tkj\\page_0.jpg", "event": "Error parsing health report", "level": "error"}
{"agent": "HealthReportParser", "timestamp": "2025-11-24T04:01:11.908934Z", "error": "OCR failed to process: C:\\Users\\Kun\\AppData\\Local\\Temp\\tmp1qns7tkj\\page_0.jpg", "page_count": 1, "event": "OCR extraction failed", "level": "error"}
{"agent": "HealthReportParser", "timestamp": "2025-11-24T04:01:11.909933Z", "completeness": 0.0, "event": "OCR extraction completed", "level": "info"}
{"agent": "HealthReportParser", "timestamp": "2025-11-24T04:01:11.909933Z", "ocr_completeness": 0.0, "threshold": 0.7, "event": "Activating LLM fallback", "level": "info"}
{"agent": "GeminiStructuredExtractor", "timestamp": "2025-11-24T04:01:11.909933Z", "input_type": "file", "action": "extract_start", "event": "LLM extraction started", "level": "info"}
{"agent": "GeminiStructuredExtractor", "timestamp": "2025-11-24T04:01:11.909933Z", "file": "S__91693062_0.jpg", "action": "extract_from_image", "event": "Extracting from image using Gemini Vision", "level": "info"}
{"agent": "GeminiStructuredExtractor", "timestamp": "2025-11-24T04:01:15.609374Z", "file": "S__91693062_0.jpg", "fields_extracted": 8, "event": "Image extraction successful", "level": "info"}
{"agent": "GeminiStructuredExtractor", "timestamp": "2025-11-24T04:01:15.609374Z", "fields_extracted": 8, "event": "LLM extraction completed successfully", "level": "info"}
{"agent": "HealthReportParser", "timestamp": "2025-11-24T04:01:15.609374Z", "llm_completeness": 0.42857142857142855, "source": "hybrid", "event": "LLM fallback completed", "level": "info"}
{"agent": "HealthReportParser", "timestamp": "2025-11-24T04:01:15.609374Z", "file": "S__91693062_0.jpg", "source": "hybrid", "completeness": 0.42857142857142855, "event": "Parsing completed successfully", "level": "info"}
{"agent": "HealthReportParser", "timestamp": "2025-11-24T04:01:15.609374Z", "file_count": 2, "overall_completeness": 0.5714285714285714, "event": "Batch parsing completed", "level": "info"}

âœ… Batch Parsing Result:
  - Overall Completeness: 57.14%
  - Files processed: 2
  - Merged fields: 15

ðŸ“Š Merged Data:
  - blood_pressure: 112/68
  - systolic: 112
  - diastolic: 68
  - bmi: 18.7
  - weight: 59.1
  - height: 177.3
  - heart_rate: 85
  - pulse: 85
  - white_blood_cells: 4.73
  - red_blood_cells: 4.48
  - hemoglobin: 14.4
  - hematocrit: 40.2
  - platelets: 257
  - glucose: 98
  - hba1c: 5.4

================================================================================
âœ… All Tests Completed Successfully!
================================================================================

ðŸ“‹ Summary:
  - Single image completeness: 42.86%
  - Batch overall completeness: 57.14%
  - OCR extraction working: Yes
